<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Freeaçaí — Montar Açaí (Responsivo)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: #f6f4fb;
    --card: #ffffff;
    --primary: #6a1b9a;
    --accent: #ff7043;
    --muted: #7b6f85;
    --radius: 14px;
    --shadow: 0 10px 30px rgba(20,12,40,0.08);
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg,#f3e9fb,#f6f4fb);
    color:#222;
    -webkit-font-smoothing:antialiased;
    padding:20px;
    display:flex;
    justify-content:center;
  }
  .wrap{width:100%;max-width:1000px}
  header{
    display:flex;gap:12px;align-items:center;
    background: linear-gradient(90deg,var(--primary), #8e24aa);
    color:white;padding:12px;border-radius:12px;box-shadow:var(--shadow);
  }
  header img{width:56px;height:56px;border-radius:10px;object-fit:cover;border:3px solid rgba(255,255,255,0.12)}
  header h1{margin:0;font-size:1.05rem}
  header p{margin:0;font-size:0.9rem;opacity:0.95}

  .grid{
    display:grid;grid-template-columns: 1fr 360px;gap:16px;margin-top:14px;
  }

  .panel{
    background:var(--card);border-radius:12px;padding:14px;box-shadow:var(--shadow);
  }
  .panel h2{margin:0 0 8px 0;color:var(--primary)}
  .controls{display:flex;gap:10px;flex-wrap:wrap}

  .btn{
    background:linear-gradient(90deg,var(--accent), #f4511e);
    color:white;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
    box-shadow: 0 8px 20px rgba(255,112,67,0.12);
  }

  .summary{
    background:var(--card);border-radius:12px;padding:14px;box-shadow:var(--shadow);position:sticky;top:20px;
  }
  .summary h3{margin:0 0 8px 0;color:var(--primary)}
  #listaPedidos{max-height:58vh;overflow:auto;padding-right:4px}
  .pedido{background:#fbf8ff;border-radius:10px;padding:10px;margin-bottom:10px;border:1px solid #efe9f8;position:relative}
  .pedido strong{display:block;margin-bottom:6px}
  .pedido .actions{position:absolute;right:8px;top:8px;display:flex;gap:6px}
  .icon-btn{background:transparent;border:none;padding:6px;border-radius:8px;cursor:pointer;font-size:0.95rem}
  .icon-btn:hover{background:rgba(0,0,0,0.04)}
  .total-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .total-row .total{font-size:1.05rem;font-weight:700;color:var(--primary)}

  /* Modal base */
  .modal{display:none;position:fixed;inset:0;background:rgba(10,8,16,0.45);z-index:1200;align-items:center;justify-content:center;padding:12px;}
  .modal.open{display:flex}
  .modal-card{
    width:100%;max-width:760px;background:linear-gradient(180deg,#fff,#fbfaff);
    border-radius:14px;padding:18px;box-shadow:0 20px 50px rgba(10,8,20,0.3);
    max-height:90vh;overflow:auto;transform-origin:center;animation:pop .16s ease;
  }
  @keyframes pop{from{opacity:0;transform:translateY(8px) scale(.995)}to{opacity:1;transform:translateY(0) scale(1)}}
  .modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:12px}
  .modal-head h2{margin:0;font-size:1.1rem}
  .close-btn{background:transparent;border:1px solid #eee;padding:8px;border-radius:10px;cursor:pointer}

  .form-grid{display:grid;grid-template-columns:1fr 240px;gap:12px}
  .form-left{padding-right:6px}
  .form-row{margin-bottom:10px}
  label.small{display:block;font-size:0.85rem;color:var(--muted);margin-bottom:6px}
  input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #e9e3f2;background:#fff}

  /* size cards */
  .sizes-grid{display:flex;gap:10px;flex-wrap:wrap}
  .size-card-modal{
    flex:1 1 110px;min-width:98px;background:linear-gradient(180deg,#fff,#fff);border-radius:12px;padding:10px;border:1px solid #eee;
    text-align:center;cursor:pointer;transition:transform .12s,box-shadow .12s;
  }
  .size-card-modal.active{box-shadow:0 12px 30px rgba(106,27,154,0.12);transform:translateY(-6px);border:2px solid rgba(255,112,67,0.12)}
  .size-card-modal img{width:56px;height:56px;object-fit:cover;border-radius:8px;display:block;margin:0 auto 6px}
  .size-qty{font-weight:700;color:var(--primary);margin-top:6px}
  .size-price{font-size:0.88rem;color:var(--muted);margin-top:4px}

  /* pills and chips */
  .pills{display:flex;gap:8px;flex-wrap:wrap}
  .pill{padding:8px 10px;border-radius:999px;border:1px solid #eee;background:#fff;cursor:pointer}
  .pill.active{background:linear-gradient(90deg,var(--primary), #8e24aa);color:white;border-color:transparent;box-shadow:0 8px 20px rgba(138,36,170,0.12)}

  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 10px;border-radius:999px;border:1px solid #e7e0f5;background:#fff;color:var(--muted);cursor:pointer;font-size:0.9rem}
  .chip.active{background:#fff0e6;border-color:rgba(255,112,67,0.18);color:var(--primary);box-shadow:0 6px 18px rgba(255,112,67,0.08)}

  .segmented{display:flex;background:#fff;border-radius:10px;border:1px solid #eee;overflow:hidden}
  .segmented button{flex:1;padding:10px;border:0;background:transparent;cursor:pointer}
  .segmented button.active{background:linear-gradient(90deg,var(--primary), #8e24aa);color:white}

  .preview{margin-top:10px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fbf7ff,#fff);border:1px solid #f0eafe;display:flex;justify-content:space-between;align-items:center}
  .preview .text{font-size:0.95rem;color:var(--muted)}
  .preview .price{font-weight:800;color:var(--accent);font-size:1.05rem}

  /* responsive adjustments */
  @media (max-width:880px){
    .grid{grid-template-columns:1fr;gap:12px}
    .form-grid{grid-template-columns:1fr;gap:10px}
    .modal{align-items:flex-end;padding:0}
    .modal-card{
      border-radius:12px 12px 0 0;max-width:100%;width:100%;
      max-height:calc(100vh - 12px - var(--safe-top)); /* bottom sheet style */
      padding:16px;
      box-shadow: 0 -10px 30px rgba(10,8,20,0.25);
    }
    .modal-head{padding-bottom:6px}
    .sizes-grid{gap:8px}
    .size-card-modal{min-width:84px;padding:8px}
    .size-card-modal img{width:48px;height:48px}
    .btn{padding:10px;border-radius:10px}
    .preview{flex-direction:column;align-items:flex-start;gap:8px}
    .preview .price{align-self:flex-end}
  }

  /* focus outline improvements */
  .size-card-modal:focus, .chip:focus, .pill:focus, .close-btn:focus, .btn:focus {outline: 3px solid rgba(106,27,154,0.14);outline-offset:2px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="Logo.jpg" alt="Logo Freeaçaí">
      <div>
        <h1>Freeaçaí</h1>
        <p>Monte seu açaí — responsivo e acessível</p>
      </div>
    </header>

    <div class="grid" style="margin-top:14px">
      <div class="panel">
        <h2>Monte e gerencie pedidos</h2>
        <p style="color:var(--muted);margin:8px 0 12px 0">Clique em <strong>Adicionar Açaí</strong> para abrir a janela de montagem.</p>
        <div class="controls">
          <button id="btnAdd" class="btn">+ Adicionar Açaí</button>
          <button class="btn" id="btnSend">Enviar pedido pelo WhatsApp</button>
        </div>
      </div>

      <aside class="summary" aria-live="polite">
        <h3>Resumo do pedido</h3>
        <div id="listaPedidos"></div>

        <div class="total-row" style="margin-top:8px">
          <div class="small" style="color:var(--muted)">Total geral</div>
          <div class="total" id="totalGeral">R$ 0,00</div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <h2 id="modalTitle">Montar Açaí</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="close-btn" id="btnClose">Cancelar</button>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-left">
          <div class="form-row">
            <label class="small">Nome do cliente</label>
            <input type="text" id="inpNome" placeholder="Ex.: João Silva">
          </div>

          <div class="form-row">
            <label class="small">Tamanho</label>
            <div class="sizes-grid" id="sizesGrid">
              <div class="size-card-modal" tabindex="0" data-price="8" data-text="200 ml - R$ 8,00">
                <img src="Copo200.jpg" alt="Copo 200ml">
                <div class="size-qty">200 ml</div>
                <div class="size-price">R$ 8,00</div>
              </div>
              <div class="size-card-modal active" tabindex="0" data-price="10" data-text="300 ml - R$ 10,00">
                <img src="Copo300.jpg" alt="Copo 300ml">
                <div class="size-qty">300 ml</div>
                <div class="size-price">R$ 10,00</div>
              </div>
              <div class="size-card-modal" tabindex="0" data-price="12" data-text="400 ml - R$ 12,00">
                <img src="Copo400.jpg" alt="Copo 400ml">
                <div class="size-qty">400 ml</div>
                <div class="size-price">R$ 12,00</div>
              </div>
              <div class="size-card-modal" tabindex="0" data-price="14" data-text="500 ml - R$ 14,00">
                <img src="Copo500.jpg" alt="Copo 500ml">
                <div class="size-qty">500 ml</div>
                <div class="size-price">R$ 14,00</div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <label class="small">Fruta</label>
            <div class="pills" id="pillsFruta">
              <div class="pill active" tabindex="0">Uva</div>
              <div class="pill" tabindex="0">Banana</div>
              <div class="pill" tabindex="0">Morango</div>
            </div>
          </div>

          <div class="form-row">
            <label class="small">Adicionais (toque para selecionar)</label>
            <div class="chips" id="chipsAdicionais">
              <div class="chip" tabindex="0">Leite em pó</div>
              <div class="chip" tabindex="0">Castanhas</div>
              <div class="chip" tabindex="0">Leite condensado</div>
              <div class="chip" tabindex="0">Paçoca</div>
              <div class="chip" tabindex="0">Granola</div>
              <div class="chip" tabindex="0">Flocos de arroz</div>
              <div class="chip" tabindex="0">M&M colorido</div>
            </div>
          </div>
        </div>

        <div class="form-right" style="padding-left:6px;display:flex;flex-direction:column;gap:10px">
          <div>
            <label class="small">Forma de pagamento</label>
            <div class="segmented" role="tablist" id="segPagamento">
              <button class="active" type="button">Pix</button>
              <button type="button">Cartão de crédito</button>
              <button type="button">Espécie</button>
            </div>
          </div>

          <div>
            <label class="small">Observação (opcional)</label>
            <input type="text" id="obs" placeholder="Ex.: Sem açúcar, por favor">
          </div>

          <div style="margin-top:auto">
            <div class="preview" aria-hidden="false">
              <div class="text" id="previewText">300 ml • Uva • Nenhum</div>
              <div class="price" id="previewPrice">R$ 10,00</div>
            </div>

            <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
              <button id="btnSave" class="btn" style="flex:1">Salvar Açaí</button>
              <button id="btnCloseAlt" class="btn" style="flex:0.6;background:#ddd;color:#333">Fechar</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // --- elementos principais ---
  const btnAdd = document.getElementById('btnAdd');
  const btnSend = document.getElementById('btnSend');
  const modal = document.getElementById('modal');
  const modalCard = modal.querySelector('.modal-card');
  const btnClose = document.getElementById('btnClose');
  const btnCloseAlt = document.getElementById('btnCloseAlt');
  const btnSave = document.getElementById('btnSave');
  const listaPedidosEl = document.getElementById('listaPedidos');
  const totalGeralEl = document.getElementById('totalGeral');
  const previewText = document.getElementById('previewText');
  const previewPrice = document.getElementById('previewPrice');
  const inpNome = document.getElementById('inpNome');
  const obsEl = document.getElementById('obs');

  let pedidos = [], editIndex = -1;
  let lastFocused = null;

  // helpers para seleção
  const sizeCards = Array.from(document.querySelectorAll('.size-card-modal'));
  const pills = Array.from(document.querySelectorAll('#pillsFruta .pill'));
  const chips = Array.from(document.querySelectorAll('#chipsAdicionais .chip'));
  const segButtons = Array.from(document.querySelectorAll('#segPagamento button'));

  // abrir modal (novo ou editar)
  function abrirModal(index = -1){
    editIndex = index;
    lastFocused = document.activeElement;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');

    if(index === -1){
      // reset defaults
      inpNome.value = '';
      obsEl.value = '';
      sizeCards.forEach(c => c.classList.toggle('active', c.dataset.price === '10')); // default 300 ml
      pills.forEach((p,i) => p.classList.toggle('active', i===0));
      chips.forEach(ch => ch.classList.remove('active'));
      segButtons.forEach((b,i) => b.classList.toggle('active', i===0));
    } else {
      const p = pedidos[index];
      inpNome.value = p.nome === "Não informado" ? "" : p.nome;
      obsEl.value = p.obs || '';
      sizeCards.forEach(c => c.classList.toggle('active', c.dataset.text === p.tamanho));
      pills.forEach(pill => pill.classList.toggle('active', pill.textContent.trim() === p.fruta));
      chips.forEach(ch => ch.classList.toggle('active', p.adicionais.includes(ch.textContent.trim())));
      segButtons.forEach(b => b.classList.toggle('active', b.textContent.trim() === p.pagamento));
    }

    atualizarPreview();
    // focus no primeiro input do modal
    setTimeout(() => inpNome.focus(), 100);

    // inicializa focus trap
    trapFocus(modalCard);
  }

  function fecharModal(){
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden','true');
    editIndex = -1;
    releaseFocusTrap();
    // devolver foco ao último botão
    if(lastFocused) lastFocused.focus();
  }

  // fechar com ESC e clicar fora
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape' && modal.classList.contains('open')) fecharModal();
  });
  modal.addEventListener('click', (e) => {
    if(e.target === modal) fecharModal();
  });

  // tamanho seleção (delegation)
  sizeCards.forEach(card => {
    card.addEventListener('click', () => {
      sizeCards.forEach(c => c.classList.remove('active'));
      card.classList.add('active');
      atualizarPreview();
    });
    card.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.click(); }
    });
  });

  // fruta
  pills.forEach(p => {
    p.addEventListener('click', () => {
      pills.forEach(x => x.classList.remove('active'));
      p.classList.add('active');
      atualizarPreview();
    });
    p.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); p.click(); }
    });
  });

  // chips adicionais (multi)
  chips.forEach(ch => {
    ch.addEventListener('click', () => { ch.classList.toggle('active'); atualizarPreview(); });
    ch.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); ch.click(); } });
  });

  // pagamento
  segButtons.forEach(b => {
    b.addEventListener('click', () => {
      segButtons.forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      atualizarPreview();
    });
  });

  // coletar dados do modal
  function coletarModal(){
    const nome = inpNome.value.trim() || 'Não informado';
    const tamanhoCard = sizeCards.find(c=>c.classList.contains('active')) || sizeCards[1]; // default 300ml (index 1)
    const tamanho = tamanhoCard.dataset.text;
    const preco = parseFloat(tamanhoCard.dataset.price);
    const fruta = (pills.find(p=>p.classList.contains('active')) || pills[0]).textContent.trim();
    const adicionais = chips.filter(c=>c.classList.contains('active')).map(c=>c.textContent.trim());
    const pagamento = (segButtons.find(b=>b.classList.contains('active')) || segButtons[0]).textContent.trim();
    const obs = obsEl.value.trim();
    return {nome, tamanho, preco, fruta, adicionais, pagamento, obs};
  }

  // salvar
  function salvarAcai(){
    const dados = coletarModal();
    if(editIndex >= 0){
      pedidos[editIndex] = dados;
    } else {
      pedidos.push(dados);
    }
    fecharModal();
    atualizarLista();
  }

  // atualizar preview do modal
  function atualizarPreview(){
    const tamanhoCard = sizeCards.find(c=>c.classList.contains('active')) || sizeCards[1];
    const preco = parseFloat(tamanhoCard.dataset.price);
    const fruta = (pills.find(p=>p.classList.contains('active')) || pills[0]).textContent.trim();
    const adicionais = chips.filter(c=>c.classList.contains('active')).map(c=>c.textContent.trim());
    const tamanhoLabel = tamanhoCard.querySelector('.size-qty')?.textContent.trim() || '300 ml';
    previewText.textContent = `${tamanhoLabel} • ${fruta} • ${adicionais.length ? adicionais.join(', ') : 'Nenhum'}`;
    previewPrice.textContent = `R$ ${preco.toFixed(2)}`;
  }

  // atualizar lista lateral
  function atualizarLista(){
    listaPedidosEl.innerHTML = '';
    let total = 0;
    pedidos.forEach((p,i)=>{
      total += p.preco;
      const div = document.createElement('div');
      div.className = 'pedido';
      div.innerHTML = `
        <div class="actions">
          <button title="Editar" class="icon-btn" data-action="edit" data-index="${i}">✏️</button>
          <button title="Excluir" class="icon-btn" data-action="delete" data-index="${i}">🗑️</button>
          <button title="Duplicar" class="icon-btn" data-action="dup" data-index="${i}">🔁</button>
        </div>
        <strong>Açaí ${i+1} — R$ ${p.preco.toFixed(2)}</strong>
        <div style="color:var(--muted);font-size:0.95rem;margin-top:6px">
          <div><strong>Cliente:</strong> ${p.nome}</div>
          <div><strong>Tamanho:</strong> ${p.tamanho}</div>
          <div><strong>Fruta:</strong> ${p.fruta}</div>
          <div><strong>Adicionais:</strong> ${p.adicionais.length ? p.adicionais.join(', ') : 'Nenhum'}</div>
          <div><strong>Pagamento:</strong> ${p.pagamento}</div>
          ${p.obs ? `<div><strong>Obs:</strong> ${p.obs}</div>` : ''}
        </div>
      `;
      listaPedidosEl.appendChild(div);
    });
    totalGeralEl.textContent = `R$ ${total.toFixed(2)}`;
  }

  // delegação para ações (editar/excluir/duplicar)
  listaPedidosEl.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-action]');
    if(!btn) return;
    const action = btn.dataset.action;
    const idx = Number(btn.dataset.index);
    if(action === 'edit') editarAcai(idx);
    if(action === 'delete') excluirAcai(idx);
    if(action === 'dup') duplicarAcai(idx);
  });

  function editarAcai(index){ abrirModal(index); }
  function excluirAcai(index){
    if(confirm('Remover este açaí do pedido?')) {
      pedidos.splice(index,1);
      atualizarLista();
    }
  }
  function duplicarAcai(index){
    const original = pedidos[index];
    if(!original) return;
    const copia = JSON.parse(JSON.stringify(original));
    pedidos.push(copia);
    atualizarLista();
    // rolar a lista para o final para mostrar o item duplicado (se necessário)
    listaPedidosEl.scrollTop = listaPedidosEl.scrollHeight;
  }

  // finalizar envio
  function finalizarPedido(){
    if(pedidos.length === 0){ alert('Adicione pelo menos um açaí antes de enviar.'); return; }
    let msg = "🍧 *Pedido de Açaí* 🍧\n";
    let total = 0;
    pedidos.forEach((p,i)=>{
      msg += `\n*Açaí ${i+1}:*\nCliente: ${p.nome}\nTamanho: ${p.tamanho}\nFruta: ${p.fruta}\nAdicionais: ${p.adicionais.length ? p.adicionais.join(', ') : 'Nenhum'}\nPagamento: ${p.pagamento}\n${p.obs ? 'Obs: ' + p.obs + '\n' : ''}Preço: R$ ${p.preco.toFixed(2)}\n`;
      total += p.preco;
    });
    msg += `\n*Total geral:* R$ ${total.toFixed(2)}`;
    const numero = "5599984001466";
    window.open("https://wa.me/" + numero + "?text=" + encodeURIComponent(msg), "_blank");
  }

  // --- focus trap (simples) ---
  let focusable = [];
  let firstFocusable = null;
  let lastFocusable = null;
  function trapFocus(container){
    focusable = Array.from(container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))
                      .filter(el => !el.hasAttribute('disabled') && el.offsetParent !== null);
    if(focusable.length){
      firstFocusable = focusable[0];
      lastFocusable = focusable[focusable.length -1];
      firstFocusable.focus();
    }
    document.addEventListener('keydown', handleTab);
  }
  function releaseFocusTrap(){
    document.removeEventListener('keydown', handleTab);
    focusable = []; firstFocusable = lastFocusable = null;
  }
  function handleTab(e){
    if(e.key !== 'Tab') return;
    if(focusable.length === 0) return;
    if(e.shiftKey){
      if(document.activeElement === firstFocusable){
        e.preventDefault();
        lastFocusable.focus();
      }
    } else {
      if(document.activeElement === lastFocusable){
        e.preventDefault();
        firstFocusable.focus();
      }
    }
  }

  // --- ligações de botões ---
  btnAdd.addEventListener('click', ()=> abrirModal(-1));
  btnSend.addEventListener('click', finalizarPedido);
  btnClose.addEventListener('click', fecharModal);
  btnCloseAlt.addEventListener('click', fecharModal);
  btnSave.addEventListener('click', salvarAcai);

  // atalho para salvar com Ctrl+Enter dentro do modal
  modal.addEventListener('keydown', (e) => {
    if((e.ctrlKey || e.metaKey) && e.key === 'Enter') salvarAcai();
  });

  // atualizações quando inputs mudam (para preview realtime)
  inpNome.addEventListener('input', atualizarPreview);
  obsEl.addEventListener('input', atualizarPreview);

  // Inicializa handlers de click para elementos que precisam de comportamento keyboard-friendly
  // (já ligado acima). Também atualiza preview inicialmente.
  atualizarPreview();
  atualizarLista();
});
</script>
</body>
</html>